var U="data-focus-lock",$="data-focus-lock-disabled",ee="data-no-focus-lock",re="data-autofocus-inside",ne="data-no-autofocus",d=function(e){for(var r=Array(e.length),n=0;n<e.length;++n)r[n]=e[n];return r},x=function(e){return Array.isArray(e)?e:[e]},te=function(e){if(e.nodeType!==Node.ELEMENT_NODE)return!1;var r=window.getComputedStyle(e,null);return!r||!r.getPropertyValue?!1:r.getPropertyValue("display")==="none"||r.getPropertyValue("visibility")==="hidden"},G=function(e){return e.parentNode&&e.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.parentNode.host:e.parentNode},L=function(e){return e===document||e&&e.nodeType===Node.DOCUMENT_NODE},ae=function(e,r){return!e||L(e)||!te(e)&&r(G(e))},R=function(e,r){var n=e.get(r);if(n!==void 0)return n;var t=ae(r,R.bind(void 0,e));return e.set(r,t),t},ue=function(e,r){return e&&!L(e)?fe(e)?r(G(e)):!1:!0},q=function(e,r){var n=e.get(r);if(n!==void 0)return n;var t=ue(r,q.bind(void 0,e));return e.set(r,t),t},W=function(e){return e.dataset},oe=function(e){return e.tagName==="BUTTON"},H=function(e){return e.tagName==="INPUT"},V=function(e){return H(e)&&e.type==="radio"},ie=function(e){return!((H(e)||oe(e))&&(e.type==="hidden"||e.disabled))},fe=function(e){var r=e.getAttribute(ne);return![!0,"true",""].includes(r)},N=function(e){var r;return Boolean(e&&((r=W(e))===null||r===void 0?void 0:r.focusGuard))},g=function(e){return!N(e)},ce=function(e){return Boolean(e)},de=function(e,r){var n=e.tabIndex-r.tabIndex,t=e.index-r.index;if(n){if(!e.tabIndex)return 1;if(!r.tabIndex)return-1}return n||t},j=function(e,r,n){return d(e).map(function(t,a){return{node:t,index:a,tabIndex:n&&t.tabIndex===-1?(t.dataset||{}).focusGuard?0:-1:t.tabIndex}}).filter(function(t){return!r||t.tabIndex>=0}).sort(de)},ve=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],F=ve.join(","),le="".concat(F,", [data-focus-guard]"),K=function(e,r){var n;return d(((n=e.shadowRoot)===null||n===void 0?void 0:n.children)||e.children).reduce(function(t,a){return t.concat(a.matches(r?le:F)?[a]:[],K(a))},[])},y=function(e,r){return e.reduce(function(n,t){return n.concat(K(t,r),t.parentNode?d(t.parentNode.querySelectorAll(F)).filter(function(a){return a===t}):[])},[])},se=function(e){var r=e.querySelectorAll("[".concat(re,"]"));return d(r).map(function(n){return y([n])}).reduce(function(n,t){return n.concat(t)},[])},T=function(e,r){return d(e).filter(function(n){return R(r,n)}).filter(function(n){return ie(n)})},P=function(e,r){return r===void 0&&(r=new Map),d(e).filter(function(n){return q(r,n)})},E=function(e,r,n){return j(T(y(e,n),r),!0,n)},M=function(e,r){return j(T(y(e),r),!1)},me=function(e,r){return T(se(e),r)},O=function(e,r){return e.shadowRoot?O(e.shadowRoot,r):Object.getPrototypeOf(e).contains!==void 0&&Object.getPrototypeOf(e).contains.call(e,r)?!0:d(e.children).some(function(n){return O(n,r)})},be=function(e){for(var r=new Set,n=e.length,t=0;t<n;t+=1)for(var a=t+1;a<n;a+=1){var i=e[t].compareDocumentPosition(e[a]);(i&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&r.add(a),(i&Node.DOCUMENT_POSITION_CONTAINS)>0&&r.add(t)}return e.filter(function(u,o){return!r.has(o)})},Y=function(e){return e.parentNode?Y(e.parentNode):e},S=function(e){var r=x(e);return r.filter(Boolean).reduce(function(n,t){var a=t.getAttribute(U);return n.push.apply(n,a?be(d(Y(t).querySelectorAll("[".concat(U,'="').concat(a,'"]:not([').concat($,'="disabled"])')))):[t]),n},[])},z=function(e){return e.activeElement?e.activeElement.shadowRoot?z(e.activeElement.shadowRoot):e.activeElement:void 0},w=function(){return document.activeElement?document.activeElement.shadowRoot?z(document.activeElement.shadowRoot):document.activeElement:void 0},Oe=function(e){return e===document.activeElement},ge=function(e){return Boolean(d(e.querySelectorAll("iframe")).some(function(r){return Oe(r)}))},Se=function(e){var r=document&&w();return!r||r.dataset&&r.dataset.focusGuard?!1:S(e).some(function(n){return O(n,r)||ge(n)})},we=function(){var e=document&&w();return e?d(document.querySelectorAll("[".concat(ee,"]"))).some(function(r){return O(r,e)}):!1},he=function(e,r){return r.filter(V).filter(function(n){return n.name===e.name}).filter(function(n){return n.checked})[0]||e},C=function(e,r){return V(e)&&e.name?he(e,r):e},pe=function(e){var r=new Set;return e.forEach(function(n){return r.add(C(n,e))}),e.filter(function(n){return r.has(n)})},k=function(e){return e[0]&&e.length>1?C(e[0],e):e[0]},B=function(e,r){return e.length>1?e.indexOf(C(e[r],e)):r},J="NEW_FOCUS",Ae=function(e,r,n,t){var a=e.length,i=e[0],u=e[a-1],o=N(n);if(!(n&&e.indexOf(n)>=0)){var f=n!==void 0?r.indexOf(n):-1,v=t?r.indexOf(t):f,l=t?e.indexOf(t):-1,c=f-v,b=r.indexOf(i),s=r.indexOf(u),m=pe(r),X=n!==void 0?m.indexOf(n):-1,Z=X-(t?m.indexOf(t):f),_=B(e,0),D=B(e,a-1);if(f===-1||l===-1)return J;if(!c&&l>=0)return l;if(f<=b&&o&&Math.abs(c)>1)return D;if(f>=s&&o&&Math.abs(c)>1)return _;if(c&&Math.abs(Z)>1)return l;if(f<=b)return D;if(f>s)return _;if(c)return Math.abs(c)>1?l:(a+l+c)%a}},xe=function(e){return function(r){var n,t=(n=W(r))===null||n===void 0?void 0:n.autofocus;return r.autofocus||t!==void 0&&t!=="false"||e.indexOf(r)>=0}},Ee=function(e,r,n){var t=e.map(function(i){var u=i.node;return u}),a=P(t.filter(xe(n)));return a&&a.length?k(a):k(P(r))},I=function(e,r){return r===void 0&&(r=[]),r.push(e),e.parentNode&&I(e.parentNode.host||e.parentNode,r),r},h=function(e,r){for(var n=I(e),t=I(r),a=0;a<n.length;a+=1){var i=n[a];if(t.indexOf(i)>=0)return i}return!1},Q=function(e,r,n){var t=x(e),a=x(r),i=t[0],u=!1;return a.filter(Boolean).forEach(function(o){u=h(u||o,o)||u,n.filter(Boolean).forEach(function(f){var v=h(i,f);v&&(!u||O(v,u)?u=v:u=h(v,u))})}),u},Ie=function(e,r){return e.reduce(function(n,t){return n.concat(me(t,r))},[])},Ne=function(e,r){var n=new Map;return r.forEach(function(t){return n.set(t.node,t)}),e.map(function(t){return n.get(t)}).filter(ce)},Fe=function(e,r){var n=document&&w(),t=S(e).filter(g),a=Q(n||e,e,t),i=new Map,u=M(t,i),o=E(t,i).filter(function(s){var m=s.node;return g(m)});if(!(!o[0]&&(o=u,!o[0]))){var f=M([a],i).map(function(s){var m=s.node;return m}),v=Ne(f,o),l=v.map(function(s){var m=s.node;return m}),c=Ae(l,f,n,r);if(c===J){var b=Ee(u,l,Ie(t,i));if(b)return{node:b};console.warn("focus-lock: cannot find any node to move focus into");return}return c===void 0?c:v[c]}},Ce=function(e){var r=S(e).filter(g),n=Q(e,e,r),t=new Map,a=E([n],t,!0),i=E(r,t).filter(function(u){var o=u.node;return g(o)}).map(function(u){var o=u.node;return o});return a.map(function(u){var o=u.node,f=u.index;return{node:o,index:f,lockItem:i.indexOf(o)>=0,guard:N(o)}})},ye=function(e,r){"focus"in e&&e.focus(r),"contentWindow"in e&&e.contentWindow&&e.contentWindow.focus()},p=0,A=!1,Te=function(e,r,n){n===void 0&&(n={});var t=Fe(e,r);if(!A&&t){if(p>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),A=!0,setTimeout(function(){A=!1},1);return}p++,ye(t.node,n.focusOptions),p--}};const _e=Te;export{$ as F,U as a,we as b,Se as f,Ce as g,_e as m};
