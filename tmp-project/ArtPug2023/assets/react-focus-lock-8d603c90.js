import{r as n}from"./react-5d4b96d5.js";import{_ as T,c as Fe}from"./@babel-387d1bfb.js";import{F as he,a as be,m as _,f as $,g as pe,b as ge}from"./focus-lock-1f5948c4.js";import{c as W,a as Ee}from"./use-sidecar-665c7840.js";import{u as Ie}from"./use-callback-ref-4e76fd9d.js";import{w as Pe}from"./react-clientside-effect-d9c4c9b2.js";var S={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},j=W({},function(r){var e=r.target,t=r.currentTarget;return{target:e,currentTarget:t}}),N=W(),we=W(),Ce=Ee({async:!0}),Le=[],B=n.forwardRef(function(e,t){var a,u=n.useState(),i=u[0],d=u[1],l=n.useRef(),g=n.useRef(!1),c=n.useRef(null),s=e.children,o=e.disabled,w=e.noFocusGuards,v=e.persistentFocus,E=e.crossFrame,f=e.autoFocus;e.allowTextSelection;var m=e.group,y=e.className,X=e.whiteList,Y=e.hasPositiveIndices,R=e.shards,Z=R===void 0?Le:R,D=e.as,ee=D===void 0?"div":D,H=e.lockProps,te=H===void 0?{}:H,re=e.sideCar,C=e.returnFocus,ne=e.focusOptions,k=e.onActivation,x=e.onDeactivation,ae=n.useState({}),oe=ae[0],ue=n.useCallback(function(){c.current=c.current||document&&document.activeElement,l.current&&k&&k(l.current),g.current=!0},[k]),ie=n.useCallback(function(){g.current=!1,x&&x(l.current)},[x]);n.useEffect(function(){o||(c.current=null)},[]);var se=n.useCallback(function(F){var I=c.current;if(I&&I.focus){var O=typeof C=="function"?C(I):C;if(O){var A=typeof O=="object"?O:void 0;c.current=null,F?Promise.resolve().then(function(){return I.focus(A)}):I.focus(A)}}},[C]),ce=n.useCallback(function(F){g.current&&j.useMedium(F)},[]),de=N.useMedium,fe=n.useCallback(function(F){l.current!==F&&(l.current=F,d(F))},[]),le=T((a={},a[he]=o&&"disabled",a[be]=m,a),te),M=w!==!0,ve=M&&w!=="tail",me=Ie([t,fe]);return n.createElement(n.Fragment,null,M&&[n.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:o?-1:0,style:S}),Y?n.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:o?-1:1,style:S}):null],!o&&n.createElement(re,{id:oe,sideCar:Ce,observed:i,disabled:o,persistentFocus:v,crossFrame:E,autoFocus:f,whiteList:X,shards:Z,onActivation:ue,onDeactivation:ie,returnFocus:se,focusOptions:ne}),n.createElement(ee,T({ref:me},le,{className:y,onBlur:de,onFocus:ce}),s),ve&&n.createElement("div",{"data-focus-guard":!0,tabIndex:o?-1:0,style:S}))});B.propTypes={};B.defaultProps={children:void 0,disabled:!1,returnFocus:!1,focusOptions:void 0,noFocusGuards:!1,autoFocus:!0,persistentFocus:!1,crossFrame:!0,hasPositiveIndices:void 0,allowTextSelection:void 0,group:void 0,className:void 0,whiteList:void 0,shards:void 0,as:"div",lockProps:{},onActivation:void 0,onDeactivation:void 0};const q=B;function z(r){var e=window,t=e.setImmediate;typeof t<"u"?t(r):setTimeout(r,1)}var ye=function(){return document&&document.activeElement===document.body},ke=function(){return ye()||ge()},b=null,h=null,p=null,P=!1,xe=function(){return!0},Oe=function(e){return(b.whiteList||xe)(e)},Se=function(e,t){p={observerNode:e,portaledElement:t}},Te=function(e){return p&&p.portaledElement===e};function U(r,e,t,a){var u=null,i=r;do{var d=a[i];if(d.guard)d.node.dataset.focusAutoGuard&&(u=d);else if(d.lockItem){if(i!==r)return;u=null}else break}while((i+=t)!==e);u&&(u.node.tabIndex=0)}var We=function(e){return e&&"current"in e?e.current:e},Be=function(e){return e?Boolean(P):P==="meanwhile"},Ge=function r(e,t,a){return t&&(t.host===e&&(!t.activeElement||a.contains(t.activeElement))||t.parentNode&&r(e,t.parentNode,a))},Re=function(e,t){return t.some(function(a){return Ge(e,a,a)})},L=function(){var e=!1;if(b){var t=b,a=t.observed,u=t.persistentFocus,i=t.autoFocus,d=t.shards,l=t.crossFrame,g=t.focusOptions,c=a||p&&p.portaledElement,s=document&&document.activeElement;if(c){var o=[c].concat(d.map(We).filter(Boolean));if((!s||Oe(s))&&(u||Be(l)||!ke()||!h&&i)&&(c&&!($(o)||s&&Re(s,o)||Te(s))&&(document&&!h&&s&&!i?(s.blur&&s.blur(),document.body.focus()):(e=_(o,h,{focusOptions:g}),p={})),P=!1,h=document&&document.activeElement),document){var w=document&&document.activeElement,v=pe(o),E=v.map(function(f){var m=f.node;return m}).indexOf(w);E>-1&&(v.filter(function(f){var m=f.guard,y=f.node;return m&&y.dataset.focusAutoGuard}).forEach(function(f){var m=f.node;return m.removeAttribute("tabIndex")}),U(E,v.length,1,v),U(E,-1,-1,v))}}}return e},J=function(e){L()&&e&&(e.stopPropagation(),e.preventDefault())},G=function(){return z(L)},De=function(e){var t=e.target,a=e.currentTarget;a.contains(t)||Se(a,t)},He=function(){return null},K=function(){P="just",setTimeout(function(){P="meanwhile"},0)},Me=function(){document.addEventListener("focusin",J),document.addEventListener("focusout",G),window.addEventListener("blur",K)},Ae=function(){document.removeEventListener("focusin",J),document.removeEventListener("focusout",G),window.removeEventListener("blur",K)};function Ue(r){return r.filter(function(e){var t=e.disabled;return!t})}function _e(r){var e=r.slice(-1)[0];e&&!b&&Me();var t=b,a=t&&e&&e.id===t.id;b=e,t&&!a&&(t.onDeactivation(),r.filter(function(u){var i=u.id;return i===t.id}).length||t.returnFocus(!e)),e?(h=null,(!a||t.observed!==e.observed)&&e.onActivation(),L(),z(L)):(Ae(),h=null)}j.assignSyncMedium(De);N.assignMedium(G);we.assignMedium(function(r){return r({moveFocusInside:_,focusInside:$})});const $e=Pe(Ue,_e)(He);var Q=n.forwardRef(function(e,t){return n.createElement(q,T({sideCar:$e,ref:t},e))}),V=q.propTypes||{};V.sideCar;Fe(V,["sideCar"]);Q.propTypes={};const Qe=Q;export{Qe as F};
